{% extends "_base.html" %}

{% from '_nav.html' import email_subnav with context %}

{% block content %}
  {{ email_subnav() }}

  <div class="panel-group" id="accordion">
    {% if not emails.items %}
      <i>{{ 'email_empty' | ui }}</i>
    {% endif %}

    {% for email in emails.items | sort_by_date(reverse=True) %}
      <div class="panel panel-default">
        <div class="panel-heading">
          <h4 class="panel-title">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapse{{ loop.index }}">
              <div class="row">
                <div class="col-sm-3">
                  {% if is_outgoing %}
                    <span class="email-sent-to">{{ email.to | join(', ') }}</span>
                  {% else %}
                    <span class="email-sent-by">{{ email.sender }}</span>
                  {% endif %}
                </div>
                <div class="col-sm-6">
                  <span class="email-subject">{{ email.subject | safe }}</span>
                </div>
                <div class="col-sm-2">
                  <span class="email-sent-at">{{ email.date | render_date }}</span>
                </div>
                <div class="col-sm-1 text-right">
                  {% if email.attachments %}
                    <span class="glyphicon glyphicon-paperclip"></span>
                  {% endif %}
                </div>
              </div>
            </a>
          </h4>
        </div>
        <div id="collapse{{ loop.index}}" class="panel-collapse collapse">
          <div class="panel-body">
            <div class="row">
              <div class="col-sm-12">
                <span class="email-body">{{ email.body | safe_multiline }}</span>
              </div>
            </div>
            {% if email.attachments %}
              <div class="row">
                <div class="col-sm-12">
                  <ul class="list-inline">
                    {% for path in email.attachments %}
                      <li><a href="{{ path | attachment_url }}">{{ path }}</a></li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  {% if emails.pages > 1 %}
    <ul class=pagination>
      {% for page in emails.iter_pages() %}
        {% if page %}
          <li class="{{ 'active' if page == emails.page else ''}}">
            <a href="{{ url_for(request.endpoint, page=page) }}">
              {{ page }}
            </a>
          </li>
        {% else %}
          <li class="disabled">
            <a href="#">&hellip;</a>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  {% endif %}

{% endblock %}
